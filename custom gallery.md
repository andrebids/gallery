# custom-gallery.php

```php
<?php /* Plugin Name: Custom Gallery with Sidebar Filters Description: Displays a custom gallery with advanced filters for tags and dimensions, available in a sidebar with pagination. Version: 1.8 Author: Your Name */ if (!defined('ABSPATH')) { exit; // Exit if accessed directly. } // Include necessary files include_once plugin_dir_path(__FILE__) . 'includes/shortcode.php'; include_once plugin_dir_path(__FILE__) . 'includes/ajax-handlers.php'; include_once plugin_dir_path(__FILE__) . 'includes/assets.php'; ?>
```

# js\custom-gallery.js

```js
jQuery(document).ready(function($) { // Initialize Select2 for other tags selection $('#filter-tags-other').select2({ placeholder: "Select tags", allowClear: true, width: '100%' }); // Apply filters when the button is clicked $('#apply-filters').on('click', function() { applyFilters(1); }); // Reset filters when the button is clicked $('#reset-filters').on('click', function() { $('#filter-tag-2d').prop('checked', false); $('#filter-tag-3d').prop('checked', false); $('#filter-tags-other').val([]).trigger('change'); $('#filter-altura').val(''); // Reset height selection applyFilters(1); }); // Function to apply filters using AJAX function applyFilters(page = 1) { var selectedTags2D3D = []; if ($('#filter-tag-2d').is(':checked')) selectedTags2D3D.push('2D'); if ($('#filter-tag-3d').is(':checked')) selectedTags2D3D.push('3D'); var selectedOtherTags = $('#filter-tags-other').val() || []; var selectedTags = selectedTags2D3D.concat(selectedOtherTags); var dimensions = { altura: $('#filter-altura').val().trim() }; $.ajax({ url: ajax_object.ajax_url, method: 'POST', data: { action: 'filter_images', tags: selectedTags, dimensions: dimensions, page: page, security: ajax_object.ajax_nonce }, success: function(response) { if (response.success) { $('#gallery-container').html(response.data.html); $('#gallery-pagination').html(response.data.pagination); updateFiltersSummary(selectedTags2D3D, selectedOtherTags, dimensions); // Re-initialize Masonry $('.custom-gallery-masonry').masonry('reloadItems').masonry('layout'); // Re-initialize lightbox after loading new images if (typeof lightbox !== 'undefined') { lightbox.init(); } // Scroll to the top of the gallery container $('html, body').animate({ scrollTop: $('#gallery-container').offset().top }, 500); // Reinitialize pagination click event initPagination(); } else { console.error('Error in AJAX response:', response); } }, error: function(xhr, status, error) { console.error('AJAX error:', error); } }); } // Update filters summary function updateFiltersSummary(selectedTags2D3D, selectedOtherTags, dimensions) { var summaryHtml = ''; if (selectedTags2D3D.length > 0) { selectedTags2D3D.forEach(function(tag) { summaryHtml += '<div class="filter-item">Tag: ' + tag + ' <span class="remove-filter" data-filter="tag" data-value="' + tag + '">x</span></div>'; }); } if (selectedOtherTags.length > 0) { selectedOtherTags.forEach(function(tag) { summaryHtml += '<div class="filter-item">Tag: ' + tag + ' <span class="remove-filter" data-filter="tag" data-value="' + tag + '">x</span></div>'; }); } if (dimensions.altura) { summaryHtml += '<div class="filter-item">Height: ' + dimensions.altura + ' <span class="remove-filter" data-filter="height">x</span></div>'; } // Show the applied filters section only if there are active filters if (summaryHtml) { $('#applied-filters').show(); } else { $('#applied-filters').hide(); } $('#filters-summary').html(summaryHtml); } // Remove individual filters $(document).on('click', '.remove-filter', function() { var filterType = $(this).data('filter'); var filterValue = $(this).data('value'); switch (filterType) { case 'tag': if (filterValue === '2D' || filterValue === '3D') { $('#filter-tag-' + filterValue.toLowerCase()).prop('checked', false); } else { var selectedTags = $('#filter-tags-other').val(); selectedTags = selectedTags.filter(function(tag) { return tag !== filterValue; }); $('#filter-tags-other').val(selectedTags).trigger('change'); } break; case 'height': $('#filter-altura').val(''); // Reset height selection break; } applyFilters(1); }); // Initialize pagination click event function initPagination() { $('.pagination a').off('click').on('click', function(e) { e.preventDefault(); var href = $(this).attr('href'); var page = href.match(/page\/(\d+)/); if (page) { applyFilters(parseInt(page[1])); } else { var pageQuery = href.match(/paged=(\d+)/); if (pageQuery) { applyFilters(parseInt(pageQuery[1])); } } }); } // Initial call to set up pagination initPagination(); });
```

# includes\shortcode.php

```php
<?php // Shortcode for the filter form add_shortcode('custom_gallery_filters', 'custom_gallery_filters_shortcode'); function custom_gallery_filters_shortcode() { ob_start(); ?> <div id="image-filter-form"> <h3>Image Filters</h3> <div> <label>2D/3D:</label> <div class="checkbox-group"> <label for="filter-tag-2d"> <input type="checkbox" id="filter-tag-2d" name="filter-tag-2d" value="2D"> 2D </label> <label for="filter-tag-3d"> <input type="checkbox" id="filter-tag-3d" name="filter-tag-3d" value="3D"> 3D </label> </div> </div> <div> <label for="filter-tags-other">Other Tags:</label> <select id="filter-tags-other" multiple style="width: 100%;"> <?php $tags = get_existing_custom_tags(); $tags_2d3d = ['2D', '3D']; $other_tags = array_diff($tags, $tags_2d3d); foreach ($other_tags as $tag) { $count = get_image_count_by_tag($tag); echo '<option value="' . esc_attr($tag) . '">' . esc_html($tag) . ' (' . $count . ' images)</option>'; } ?> </select> </div> <div> <label for="filter-altura">Height:</label> <input type="text" id="filter-altura" placeholder="Height"> </div> <div class="filter-buttons"> <button id="apply-filters">Apply Filters</button> <button id="reset-filters">Reset Filters</button> </div> <div id="applied-filters" style="display: none;"> <h4>Applied Filters:</h4> <div id="filters-summary"></div> </div> </div> <?php return ob_get_clean(); } // Shortcode for the gallery add_shortcode('custom_gallery', 'custom_gallery_shortcode'); function custom_gallery_shortcode() { ob_start(); ?> <div id="gallery-container" class="custom-gallery-masonry"> <?php // Display images with pagination $logo_image_id = 3728; // ID of the logo image to exclude $paged = (get_query_var('paged')) ? get_query_var('paged') : 1; $posts_per_page = 20; $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => $posts_per_page, 'paged' => $paged, 'post__not_in' => array($logo_image_id), // Exclude by attachment ID 'meta_query' => array( array( 'key' => '_wp_attachment_metadata', 'compare' => 'EXISTS', ), ), ); $images_query = new WP_Query($args); if ($images_query->have_posts()) { while ($images_query->have_posts()) { $images_query->the_post(); $image_id = get_the_ID(); $img_url = wp_get_attachment_url($image_id); $alt_text = get_post_meta($image_id, '_wp_attachment_image_alt', true); echo '<div class="masonry-item">'; echo '<a href="' . esc_url($img_url) . '" data-lightbox="gallery" data-title="' . esc_attr($alt_text) . '">'; echo '<img src="' . esc_url($img_url) . '" alt="' . esc_attr($alt_text) . '" />'; echo '</a>'; echo '</div>'; } } else { echo '<p>No images found.</p>'; } echo render_gallery_pagination($images_query); // Render pagination within the gallery container wp_reset_postdata(); ?> </div> <?php return ob_get_clean(); } // Function to render pagination function render_gallery_pagination($query) { $total_pages = $query->max_num_pages; if ($total_pages > 1) { $current_page = max(1, get_query_var('paged', 1)); return '<div class="pagination" style="display: flex; justify-content: center; list-style-type: none; padding: 10px 0;">' . implode('', array_map(function($link) { return "<div>$link</div>"; }, paginate_links(array( 'base' => str_replace(999999999, '%#%', esc_url(get_pagenum_link(999999999))), 'format' => '?paged=%#%', 'current' => $current_page, 'total' => $total_pages, 'prev_text' => __('&laquo; Previous'), 'next_text' => __('Next &raquo;'), 'type' => 'array', 'add_args' => false, )))) . '</div>'; } } // Shortcode for pagination add_shortcode('gallery_pagination', 'gallery_pagination_shortcode'); function gallery_pagination_shortcode($atts) { $atts = shortcode_atts(array( 'query' => null ), $atts, 'gallery_pagination'); if (isset($atts['query']) && $atts['query'] instanceof WP_Query) { return render_gallery_pagination($atts['query']); } return ''; } // Function to get all existing tags for autocomplete if (!function_exists('get_existing_custom_tags')) { function get_existing_custom_tags() { $tags = get_terms(array( 'taxonomy' => 'custom_tag', 'hide_empty' => false, )); return is_array($tags) ? wp_list_pluck($tags, 'name') : []; } } // Function to count the number of images for a given tag function get_image_count_by_tag($tag_name) { $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => -1, 'tax_query' => array( array( 'taxonomy' => 'custom_tag', 'field' => 'name', 'terms' => $tag_name, ), ), ); $query = new WP_Query($args); return $query->found_posts; } ?>
```

# includes\assets.php

```php
<?php // Enqueue CSS and JavaScript for Gallery and Lightbox add_action('wp_enqueue_scripts', 'custom_gallery_assets'); function custom_gallery_assets() { wp_enqueue_style('custom-gallery-css', plugins_url('../css/custom-gallery.css', __FILE__)); wp_enqueue_script('jquery-masonry'); // Lightbox2 wp_enqueue_style('lightbox-css', 'https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css'); wp_enqueue_script('lightbox-js', 'https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js', array('jquery'), '2.11.3', true); // Include Select2 CSS and JS wp_enqueue_style('select2-css', 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css'); wp_enqueue_script('select2-js', 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js', array('jquery'), '4.0.13', true); // Enqueue custom gallery script wp_enqueue_script('custom-gallery-js', plugins_url('../js/custom-gallery.js', __FILE__), array('jquery'), '1.0', true); // Localize the script with new data $script_data_array = array( 'ajax_url' => admin_url('admin-ajax.php'), 'ajax_nonce' => wp_create_nonce('filter_images_nonce'), ); wp_localize_script('custom-gallery-js', 'ajax_object', $script_data_array); } ?>
```

# includes\ajax-handlers.php

```php
<?php // Handle AJAX request to filter images add_action('wp_ajax_filter_images', 'filter_images'); add_action('wp_ajax_nopriv_filter_images', 'filter_images'); function filter_images() { check_ajax_referer('filter_images_nonce', 'security'); // Get request data $selected_tags = isset($_POST['tags']) ? array_map('sanitize_text_field', $_POST['tags']) : []; $dimensions = $_POST['dimensions']; $paged = isset($_POST['page']) ? intval($_POST['page']) : 1; // Logo image ID to exclude $logo_image_id = 3728; // ID of the logo image to exclude // Set up the query $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => 20, 'paged' => $paged, 'post__not_in' => array($logo_image_id), // Exclude by attachment ID 'tax_query' => array(), 'meta_query' => array('relation' => 'AND'), ); // Add tag filter if necessary if (!empty($selected_tags)) { $args['tax_query'][] = array( 'taxonomy' => 'custom_tag', 'field' => 'name', 'terms' => $selected_tags, 'operator' => 'AND', ); } // Add dimension filters foreach ($dimensions as $key => $value) { if (!empty($value)) { $args['meta_query'][] = array( 'key' => 'image_dimensions', 'value' => sprintf(':"%s";s:%d:"%s";', $key, strlen($value), $value), 'compare' => 'LIKE', ); } } $images_query = new WP_Query($args); ob_start(); if ($images_query->have_posts()) { while ($images_query->have_posts()) { $images_query->the_post(); $image_id = get_the_ID(); $img_url = wp_get_attachment_url($image_id); $alt_text = get_post_meta($image_id, '_wp_attachment_image_alt', true); echo '<div class="masonry-item">'; echo '<a href="' . esc_url($img_url) . '" data-lightbox="gallery" data-title="' . esc_attr($alt_text) . '">'; echo '<img src="' . esc_url($img_url) . '" alt="' . esc_attr($alt_text) . '" />'; echo '</a>'; echo '</div>'; } // Render pagination echo '<div id="gallery-pagination" class="pagination" style="display: flex; justify-content: center; padding: 10px 0;">'; $big = 999999999; // need an unlikely integer echo paginate_links(array( 'base' => str_replace($big, '%#%', esc_url(get_pagenum_link($big))), 'format' => '?paged=%#%', 'current' => max(1, $paged), 'total' => $images_query->max_num_pages, 'prev_text' => __('&laquo; Previous'), 'next_text' => __('Next &raquo;'), 'type' => 'plain', )); echo '</div>'; } else { echo '<p>No images found.</p>'; } $output = ob_get_clean(); wp_reset_postdata(); wp_send_json_success(array( 'html' => $output, 'max_pages' => $images_query->max_num_pages, 'current_page' => $paged )); } ?>
```

# css\custom-gallery.css

```css
/* Estilo para fundo escuro */ #image-filter-form { margin: 20px 0; padding: 20px; background-color: rgba(0, 0, 0, 0.6); border: 1px solid #444; border-radius: 8px; max-width: 300px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } #image-filter-form h3 { color: #fff; margin-bottom: 20px; font-size: 18px; text-transform: uppercase; letter-spacing: 0.5px; } #image-filter-form > div { margin-bottom: 20px; } #image-filter-form label { font-weight: bold; color: #fff; display: block; margin-bottom: 8px; font-size: 14px; } #image-filter-form input[type="text"], #image-filter-form select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #666; border-radius: 4px; box-sizing: border-box; background-color: rgba(255, 255, 255, 0.1); color: #fff; font-size: 14px; transition: all 0.3s ease; } #image-filter-form input[type="text"]:focus, #image-filter-form select:focus { outline: none; border-color: #1e90ff; box-shadow: 0 0 0 2px rgba(30, 144, 255, 0.2); } #image-filter-form .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 5px; } #image-filter-form .checkbox-group label { display: flex; align-items: center; font-weight: normal; margin: 0; } #image-filter-form .checkbox-group input[type="checkbox"] { margin-right: 5px; transform: scale(1.2); accent-color: #1e90ff; } .filter-buttons { display: flex; justify-content: space-between; margin-top: 20px; } #image-filter-form button { background-color: #1e90ff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; width: calc(50% - 5px); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } #image-filter-form button:hover { background-color: #4682b4; transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); } #image-filter-form button:active { transform: translateY(0); box-shadow: none; } .custom-gallery-masonry { column-count: 4; column-gap: 10px; margin-top: 20px; } .masonry-item { break-inside: avoid; margin-bottom: 10px; overflow: hidden; border-radius: 4px; position: relative; transition: transform 0.2s ease-in-out; } .masonry-item img { width: 100%; height: auto; display: block; transition: transform 0.2s ease-in-out; } .masonry-item img:hover { transform: scale(1.05); } /* Estilo da paginação */ #gallery-pagination { display: flex; justify-content: center; list-style-type: none; padding: 10px 0; } .pagination { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 5px; list-style-type: none; } .pagination .page-numbers { color: #1e90ff; text-decoration: none; padding: 5px 10px; border: 1px solid #1e90ff; border-radius: 4px; margin: 0 2px; transition: background-color 0.2s, color 0.2s; display: inline-block; } .pagination .page-numbers:hover:not(.current) { background-color: #1e90ff; color: #fff; } .pagination .page-numbers.current { background-color: #1e90ff; color: #fff; border-color: #1e90ff; } #filters-summary { margin-top: 15px; padding: 10px; border: 1px solid #666; border-radius: 4px; background-color: #333; } .filter-item { display: inline-block; margin-right: 10px; padding: 5px; background-color: #444; color: #fff; border-radius: 4px; } .remove-filter { cursor: pointer; margin-left: 5px; color: #ff6347; } /* Responsive adjustments */ @media (max-width: 768px) { .custom-gallery-masonry { column-count: 2; } #image-filter-form { max-width: 100%; } .filter-buttons { flex-direction: column; } #image-filter-form button { width: 100%; margin-bottom: 10px; } }
```

# bk\shortcode.php

```php
<?php // Shortcode for the filter form add_shortcode('custom_gallery_filters', 'custom_gallery_filters_shortcode'); function custom_gallery_filters_shortcode() { ob_start(); ?> <div id="image-filter-form"> <h3>Image Filters</h3> <div> <label for="search-image-name">Search by Image Name:</label> <input type="text" id="search-image-name" placeholder="Enter image name..."> </div> <div> <label>2D/3D:</label> <div class="checkbox-group"> <label for="filter-tag-2d"> <input type="checkbox" id="filter-tag-2d" name="filter-tag-2d" value="2D"> 2D </label> <label for="filter-tag-3d"> <input type="checkbox" id="filter-tag-3d" name="filter-tag-3d" value="3D"> 3D </label> </div> </div> <div> <label for="filter-tags-other">Other Tags:</label> <select id="filter-tags-other" multiple style="width: 100%;"> <?php $tags = get_existing_custom_tags(); $tags_2d3d = ['2D', '3D']; $other_tags = array_diff($tags, $tags_2d3d); foreach ($other_tags as $tag) { $count = get_image_count_by_tag($tag); echo '<option value="' . esc_attr($tag) . '">' . esc_html($tag) . ' (' . $count . ' images)</option>'; } ?> </select> </div> <div> <label for="filter-altura">Height:</label> <input type="text" id="filter-altura" placeholder="Height"> </div> <div class="filter-buttons"> <button id="apply-filters">Apply Filters</button> <button id="reset-filters">Reset Filters</button> </div> <div id="applied-filters" style="display: none;"> <h4>Applied Filters:</h4> <div id="filters-summary"></div> </div> </div> <?php return ob_get_clean(); } // Shortcode for the gallery add_shortcode('custom_gallery', 'custom_gallery_shortcode'); function custom_gallery_shortcode() { ob_start(); ?> <div id="gallery-container" class="custom-gallery-masonry"> <?php // Display images with pagination $logo_image_id = 3728; // ID of the logo image to exclude $paged = (get_query_var('paged')) ? get_query_var('paged') : 1; $posts_per_page = 20; $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => $posts_per_page, 'paged' => $paged, 'post__not_in' => array($logo_image_id), // Exclude by attachment ID 'meta_query' => array( array( 'key' => '_wp_attachment_metadata', 'compare' => 'EXISTS', ), ), ); $images_query = new WP_Query($args); if ($images_query->have_posts()) { while ($images_query->have_posts()) { $images_query->the_post(); $image_id = get_the_ID(); $img_url = wp_get_attachment_url($image_id); $alt_text = get_post_meta($image_id, '_wp_attachment_image_alt', true); echo '<div class="masonry-item">'; echo '<a href="' . esc_url($img_url) . '" data-lightbox="gallery" data-title="' . esc_attr($alt_text) . '">'; echo '<img src="' . esc_url($img_url) . '" alt="' . esc_attr($alt_text) . '" />'; echo '</a>'; echo '</div>'; } } else { echo '<p>No images found.</p>'; } echo render_gallery_pagination($images_query); // Render pagination using shortcode wp_reset_postdata(); ?> </div> <?php return ob_get_clean(); } // Function to render pagination function render_gallery_pagination($query) { $total_pages = $query->max_num_pages; if ($total_pages > 1) { $current_page = max(1, get_query_var('paged', 1)); return '<div class="pagination" style="display: flex; justify-content: center; list-style-type: none; padding: 10px 0;">' . implode('', array_map(function($link) { return "<div>$link</div>"; }, paginate_links(array( 'base' => str_replace(999999999, '%#%', esc_url(get_pagenum_link(999999999))), 'format' => '?paged=%#%', 'current' => $current_page, 'total' => $total_pages, 'prev_text' => __('&laquo; Previous'), 'next_text' => __('Next &raquo;'), 'type' => 'array', 'add_args' => false, )))) . '</div>'; } } // Shortcode for pagination add_shortcode('gallery_pagination', 'gallery_pagination_shortcode'); function gallery_pagination_shortcode($atts) { $atts = shortcode_atts(array( 'query' => null ), $atts, 'gallery_pagination'); if (isset($atts['query']) && $atts['query'] instanceof WP_Query) { return render_gallery_pagination($atts['query']); } return ''; } // Function to get all existing tags for autocomplete if (!function_exists('get_existing_custom_tags')) { function get_existing_custom_tags() { $tags = get_terms(array( 'taxonomy' => 'custom_tag', 'hide_empty' => false, )); return is_array($tags) ? wp_list_pluck($tags, 'name') : []; } } // Function to count the number of images for a given tag function get_image_count_by_tag($tag_name) { $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => -1, 'tax_query' => array( array( 'taxonomy' => 'custom_tag', 'field' => 'name', 'terms' => $tag_name, ), ), ); $query = new WP_Query($args); return $query->found_posts; }
```

# bk\custom-gallery.php

```php
<?php /* Plugin Name: Custom Gallery with Sidebar Filters Description: Displays a custom gallery with advanced filters for tags and dimensions, available in a sidebar with pagination. Version: 1.8 Author: Your Name */ if (!defined('ABSPATH')) { exit; // Exit if accessed directly. } // Include necessary files include_once plugin_dir_path(__FILE__) . 'shortcode.php'; include_once plugin_dir_path(__FILE__) . 'ajax-handlers.php'; include_once plugin_dir_path(__FILE__) . 'assets.php';
```

# bk\custom-gallery.js

```js
jQuery(document).ready(function($) { // Initialize Select2 for other tags selection $('#filter-tags-other').select2({ placeholder: "Select tags", allowClear: true, width: '100%' }); // Apply filters when the button is clicked $('#apply-filters').on('click', function() { applyFilters(1); }); // Reset filters when the button is clicked $('#reset-filters').on('click', function() { $('#search-image-name').val(''); $('#filter-tag-2d').prop('checked', false); $('#filter-tag-3d').prop('checked', false); $('#filter-tags-other').val([]).trigger('change'); $('#filter-altura').val(''); // Reset height selection applyFilters(1); }); // Function to apply filters using AJAX function applyFilters(page = 1) { var searchImageName = $('#search-image-name').val().trim().toLowerCase(); var selectedTags2D3D = []; if ($('#filter-tag-2d').is(':checked')) selectedTags2D3D.push('2D'); if ($('#filter-tag-3d').is(':checked')) selectedTags2D3D.push('3D'); var selectedOtherTags = $('#filter-tags-other').val() || []; var selectedTags = selectedTags2D3D.concat(selectedOtherTags); var dimensions = { altura: $('#filter-altura').val().trim() }; $.ajax({ url: ajax_object.ajax_url, method: 'POST', data: { action: 'filter_images', search_image_name: searchImageName, tags: selectedTags, dimensions: dimensions, page: page, security: ajax_object.ajax_nonce }, success: function(response) { if (response.success) { $('#gallery-container').html(response.data.html); updateFiltersSummary(searchImageName, selectedTags2D3D, selectedOtherTags, dimensions); // Re-initialize Masonry $('.custom-gallery-masonry').masonry('reloadItems').masonry('layout'); // Re-initialize lightbox after loading new images if (typeof lightbox !== 'undefined') { lightbox.init(); } // Scroll to the top of the gallery container $('html, body').animate({ scrollTop: $('#gallery-container').offset().top }, 500); // Reinitialize pagination click event initPagination(); } else { console.error('Error in AJAX response:', response); } }, error: function(xhr, status, error) { console.error('AJAX error:', error); } }); } // Update filters summary function updateFiltersSummary(searchImageName, selectedTags2D3D, selectedOtherTags, dimensions) { var summaryHtml = ''; if (searchImageName) { summaryHtml += '<div class="filter-item">Name: ' + searchImageName + ' <span class="remove-filter" data-filter="name">x</span></div>'; } if (selectedTags2D3D.length > 0) { selectedTags2D3D.forEach(function(tag) { summaryHtml += '<div class="filter-item">Tag: ' + tag + ' <span class="remove-filter" data-filter="tag" data-value="' + tag + '">x</span></div>'; }); } if (selectedOtherTags.length > 0) { selectedOtherTags.forEach(function(tag) { summaryHtml += '<div class="filter-item">Tag: ' + tag + ' <span class="remove-filter" data-filter="tag" data-value="' + tag + '">x</span></div>'; }); } if (dimensions.altura) { summaryHtml += '<div class="filter-item">Height: ' + dimensions.altura + ' <span class="remove-filter" data-filter="height">x</span></div>'; } // Show the applied filters section only if there are active filters if (summaryHtml) { $('#applied-filters').show(); } else { $('#applied-filters').hide(); } $('#filters-summary').html(summaryHtml); } // Remove individual filters $(document).on('click', '.remove-filter', function() { var filterType = $(this).data('filter'); var filterValue = $(this).data('value'); switch (filterType) { case 'name': $('#search-image-name').val(''); break; case 'tag': if (filterValue === '2D' || filterValue === '3D') { $('#filter-tag-' + filterValue.toLowerCase()).prop('checked', false); } else { var selectedTags = $('#filter-tags-other').val(); selectedTags = selectedTags.filter(function(tag) { return tag !== filterValue; }); $('#filter-tags-other').val(selectedTags).trigger('change'); } break; case 'height': $('#filter-altura').val(''); // Reset height selection break; } applyFilters(1); }); // Initialize pagination click event function initPagination() { $('.pagination a').off('click').on('click', function(e) { e.preventDefault(); var href = $(this).attr('href'); var page = href.match(/page\/(\d+)/); if (page) { applyFilters(parseInt(page[1])); } else { var pageQuery = href.match(/paged=(\d+)/); if (pageQuery) { applyFilters(parseInt(pageQuery[1])); } } }); } // Initial call to set up pagination initPagination(); });
```

# bk\custom-gallery.css

```css
/* Estilo para fundo escuro */ #image-filter-form { margin: 20px 0; padding: 20px; background-color: rgba(0, 0, 0, 0.6); border: 1px solid #444; border-radius: 8px; max-width: 300px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); } #image-filter-form h3 { color: #fff; margin-bottom: 20px; font-size: 18px; text-transform: uppercase; letter-spacing: 0.5px; } #image-filter-form > div { margin-bottom: 20px; } #image-filter-form label { font-weight: bold; color: #fff; display: block; margin-bottom: 8px; font-size: 14px; } #image-filter-form input[type="text"], #image-filter-form select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #666; border-radius: 4px; box-sizing: border-box; background-color: rgba(255, 255, 255, 0.1); color: #fff; font-size: 14px; transition: all 0.3s ease; } #image-filter-form input[type="text"]:focus, #image-filter-form select:focus { outline: none; border-color: #1e90ff; box-shadow: 0 0 0 2px rgba(30, 144, 255, 0.2); } #image-filter-form .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 5px; } #image-filter-form .checkbox-group label { display: flex; align-items: center; font-weight: normal; margin: 0; } #image-filter-form .checkbox-group input[type="checkbox"] { margin-right: 5px; transform: scale(1.2); accent-color: #1e90ff; } .filter-buttons { display: flex; justify-content: space-between; margin-top: 20px; } #image-filter-form button { background-color: #1e90ff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.3s ease; width: calc(50% - 5px); font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; } #image-filter-form button:hover { background-color: #4682b4; transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); } #image-filter-form button:active { transform: translateY(0); box-shadow: none; } .custom-gallery-masonry { column-count: 4; column-gap: 10px; margin-top: 20px; } .masonry-item { break-inside: avoid; margin-bottom: 10px; overflow: hidden; border-radius: 4px; position: relative; transition: transform 0.2s ease-in-out; } .masonry-item img { width: 100%; height: auto; display: block; transition: transform 0.2s ease-in-out; } .masonry-item img:hover { transform: scale(1.05); } /* Estilo da paginação */ .pagination { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 5px; padding: 10px 0; margin: 20px 0; list-style-type: none; } .pagination .page-numbers { color: #1e90ff; text-decoration: none; padding: 5px 10px; border: 1px solid #1e90ff; border-radius: 4px; margin: 0 2px; transition: background-color 0.2s, color 0.2s; display: inline-block; } .pagination .page-numbers:hover:not(.current) { background-color: #1e90ff; color: #fff; } .pagination .page-numbers.current { background-color: #1e90ff; color: #fff; border-color: #1e90ff; } #filters-summary { margin-top: 15px; padding: 10px; border: 1px solid #666; border-radius: 4px; background-color: #333; } .filter-item { display: inline-block; margin-right: 10px; padding: 5px; background-color: #444; color: #fff; border-radius: 4px; } .remove-filter { cursor: pointer; margin-left: 5px; color: #ff6347; } /* Responsive adjustments */ @media (max-width: 768px) { .custom-gallery-masonry { column-count: 2; } #image-filter-form { max-width: 100%; } .filter-buttons { flex-direction: column; } #image-filter-form button { width: 100%; margin-bottom: 10px; } }
```

# bk\assets.php

```php
<?php // Enqueue CSS and JavaScript for Gallery and Lightbox add_action('wp_enqueue_scripts', 'custom_gallery_assets'); function custom_gallery_assets() { wp_enqueue_style('custom-gallery-css', plugins_url('custom-gallery.css', __FILE__)); wp_enqueue_script('jquery-masonry'); // Lightbox2 wp_enqueue_style('lightbox-css', 'https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css'); wp_enqueue_script('lightbox-js', 'https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js', array('jquery'), '2.11.3', true); // Include Select2 CSS and JS wp_enqueue_style('select2-css', 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css'); wp_enqueue_script('select2-js', 'https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js', array('jquery'), '4.0.13', true); // Enqueue custom gallery script wp_enqueue_script('custom-gallery-js', plugins_url('custom-gallery.js', __FILE__), array('jquery'), '1.0', true); // Localize the script with new data $script_data_array = array( 'ajax_url' => admin_url('admin-ajax.php'), 'ajax_nonce' => wp_create_nonce('filter_images_nonce'), ); wp_localize_script('custom-gallery-js', 'ajax_object', $script_data_array); }
```

# bk\ajax-handlers.php

```php
<?php // Handle AJAX request to filter images add_action('wp_ajax_filter_images', 'filter_images'); add_action('wp_ajax_nopriv_filter_images', 'filter_images'); function filter_images() { check_ajax_referer('filter_images_nonce', 'security'); // Get request data $search_image_name = sanitize_text_field($_POST['search_image_name']); $selected_tags = isset($_POST['tags']) ? array_map('sanitize_text_field', $_POST['tags']) : []; $dimensions = $_POST['dimensions']; $paged = isset($_POST['page']) ? intval($_POST['page']) : 1; // Logo image ID to exclude $logo_image_id = 3728; // ID of the logo image to exclude // Set up the query $args = array( 'post_type' => 'attachment', 'post_mime_type' => 'image', 'post_status' => 'inherit', 'posts_per_page' => 20, 'paged' => $paged, 'post__not_in' => array($logo_image_id), // Exclude by attachment ID 'tax_query' => array(), 'meta_query' => array('relation' => 'AND'), ); // Add image name filter if necessary if (!empty($search_image_name)) { $args['s'] = $search_image_name; } // Add tag filter if necessary if (!empty($selected_tags)) { $args['tax_query'][] = array( 'taxonomy' => 'custom_tag', 'field' => 'name', 'terms' => $selected_tags, 'operator' => 'AND', ); } // Add dimension filters foreach ($dimensions as $key => $value) { if (!empty($value)) { $args['meta_query'][] = array( 'key' => 'image_dimensions', 'value' => sprintf(':"%s";s:%d:"%s";', $key, strlen($value), $value), 'compare' => 'LIKE', ); } } $images_query = new WP_Query($args); ob_start(); if ($images_query->have_posts()) { while ($images_query->have_posts()) { $images_query->the_post(); $image_id = get_the_ID(); $img_url = wp_get_attachment_url($image_id); $alt_text = get_post_meta($image_id, '_wp_attachment_image_alt', true); echo '<div class="masonry-item">'; echo '<a href="' . esc_url($img_url) . '" data-lightbox="gallery" data-title="' . esc_attr($alt_text) . '">'; echo '<img src="' . esc_url($img_url) . '" alt="' . esc_attr($alt_text) . '" />'; echo '</a>'; echo '</div>'; } // Render pagination echo '<div class="pagination" style="display: flex; justify-content: center; padding: 10px 0;">'; $big = 999999999; // need an unlikely integer echo paginate_links(array( 'base' => str_replace($big, '%#%', esc_url(get_pagenum_link($big))), 'format' => '?paged=%#%', 'current' => max(1, $paged), 'total' => $images_query->max_num_pages, 'prev_text' => __('&laquo; Previous'), 'next_text' => __('Next &raquo;'), 'type' => 'plain', )); echo '</div>'; } else { echo '<p>No images found.</p>'; } $output = ob_get_clean(); wp_reset_postdata(); wp_send_json_success(array( 'html' => $output, 'max_pages' => $images_query->max_num_pages, 'current_page' => $paged )); }
```

